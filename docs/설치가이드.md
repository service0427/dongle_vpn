# ë‹¤ì¤‘ ë™ê¸€ VPN ê²Œì´íŠ¸ì›¨ì´ ì„¤ì¹˜ ê°€ì´ë“œ

## ğŸ“Œ ì‹œìŠ¤í…œ ê°œìš”

USB ë™ê¸€ 11~20ê°œë¥¼ ì‚¬ìš©í•˜ì—¬ ë‹¤ì¤‘ ì—ì´ì „íŠ¸ê°€ ë™ì‹œì— ì ‘ì† ê°€ëŠ¥í•œ VPN ê²Œì´íŠ¸ì›¨ì´ ì„œë²„ êµ¬ì¶• ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

### ì£¼ìš” íŠ¹ì§•
- **6ê°œ ë…ë¦½ VPN ì„œë²„** (WireGuard ê¸°ë°˜)
- **ìë™ ë¶€í•˜ ë¶„ì‚°** (ë™ê¸€ ê°„ íŠ¸ë˜í”½ ë¶„ì‚°)
- **Kill Switch** (VPN ì—°ê²° ì‹¤íŒ¨ ì‹œ IP ë³´í˜¸)
- **ë™ì  ì—ì´ì „íŠ¸ ê´€ë¦¬** (ìë™ IP í• ë‹¹ ë° ê´€ë¦¬)
- **ìœ ì—°í•œ ì¸ì¦ ì‹œìŠ¤í…œ** (ì„ì‹œ/ì˜êµ¬/QRì½”ë“œ ì ‘ì†)

---

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

### 1ë‹¨ê³„: ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­
- Linux (RHEL/CentOS/Fedora 9)
- Python 3.9 ì´ìƒ
- ë£¨íŠ¸ ê¶Œí•œ
- USB ë™ê¸€ 11~20ê°œ
- ê¸°ê°€ë¹„íŠ¸ ì´ë”ë„· (ê¶Œì¥)

### 2ë‹¨ê³„: ê¸°ë³¸ íŒ¨í‚¤ì§€ ì„¤ì¹˜
```bash
# ì‹œìŠ¤í…œ ì—…ë°ì´íŠ¸
sudo dnf update -y

# WireGuard ì„¤ì¹˜
sudo dnf install -y wireguard-tools

# Python ë° ê´€ë ¨ íŒ¨í‚¤ì§€
sudo dnf install -y python3 python3-pip
pip3 install flask qrcode pillow

# ë„¤íŠ¸ì›Œí¬ ë„êµ¬
sudo dnf install -y NetworkManager iptables-services
```

### 3ë‹¨ê³„: VPN ì„œë²„ ìë™ ì„¤ì •
```bash
# ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬
chmod +x scripts/multi_agent_vpn_setup.sh

# VPN ì„œë²„ 6ê°œ ìë™ ìƒì„±
sudo bash scripts/multi_agent_vpn_setup.sh
```

---

## âš™ï¸ ìƒì„¸ ì„¤ì •

### 1. IP í¬ì›Œë”© í™œì„±í™”

```bash
# ì˜êµ¬ ì„¤ì •
echo 'net.ipv4.ip_forward = 1' | sudo tee -a /etc/sysctl.conf
sudo sysctl -p
```

### 2. VPN ì¸í„°í˜ì´ìŠ¤ êµ¬ì„±

ê° VPN ì¸í„°í˜ì´ìŠ¤ëŠ” ë…ë¦½ì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤:

| ì¸í„°í˜ì´ìŠ¤ | í¬íŠ¸ | ì„œë¸Œë„· | ë™ê¸€ ë¼ìš°íŒ… |
|-----------|------|--------|------------|
| wg0 | 51820 | 10.0.0.0/24 | ë™ê¸€1 |
| wg1 | 51821 | 10.0.1.0/24 | ë™ê¸€2 |
| wg2 | 51822 | 10.0.2.0/24 | ë™ê¸€1 |
| wg3 | 51823 | 10.0.3.0/24 | ë™ê¸€2 |
| wg4 | 51824 | 10.0.4.0/24 | ë™ê¸€1 |
| wg5 | 51825 | 10.0.5.0/24 | ë™ê¸€2 |

### 3. ë¼ìš°íŒ… í…Œì´ë¸” ì„¤ì •

```bash
# ê° VPNìš© ë…ë¦½ ë¼ìš°íŒ… í…Œì´ë¸”
ip rule add from 10.0.0.0/24 lookup 200
ip route add default dev enp0s21f0u4 table 200

# NAT ì„¤ì •
iptables -t nat -A POSTROUTING -s 10.0.0.0/24 -o enp0s21f0u4 -j MASQUERADE
```

### 4. Kill Switch í™œì„±í™”

```bash
# Kill Switch ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
sudo bash scripts/vpn_killswitch.sh

# ê·œì¹™ í™•ì¸
iptables -L -n -v
```

---

## ğŸ‘¥ í´ë¼ì´ì–¸íŠ¸ ì—°ê²°

### ìë™ í´ë¼ì´ì–¸íŠ¸ ìƒì„±

```python
# ì—ì´ì „íŠ¸ ì—°ê²° ê´€ë¦¬ì ì‹¤í–‰
python3 src/agent_connection_manager.py

# ìƒˆ ì—ì´ì „íŠ¸ ì¶”ê°€ (Python ìŠ¤í¬ë¦½íŠ¸ ë‚´ì—ì„œ)
manager = AgentConnectionManager()
result = manager.assign_agent("agent_001", "ì—ì´ì „íŠ¸1")
print(result['config'])
```

### ìˆ˜ë™ í´ë¼ì´ì–¸íŠ¸ ì„¤ì •

`/etc/wireguard/client.conf` íŒŒì¼ ìƒì„±:

```ini
[Interface]
PrivateKey = [ìƒì„±ëœ_ê°œì¸í‚¤]
Address = 10.0.0.2/32
DNS = 8.8.8.8

[Peer]
PublicKey = [ì„œë²„_ê³µê°œí‚¤]
Endpoint = [ì„œë²„_IP]:51820
AllowedIPs = 0.0.0.0/0
PersistentKeepalive = 25
```

### ì—°ê²° ëª…ë ¹ì–´

```bash
# í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì‹¤í–‰
wg-quick up ./client.conf

# ì—°ê²° í™•ì¸
curl ifconfig.me
```

---

## ğŸ”§ ê´€ë¦¬ ë° ëª¨ë‹ˆí„°ë§

### VPN ìƒíƒœ í™•ì¸

```bash
# ì „ì²´ ì¸í„°í˜ì´ìŠ¤ ìƒíƒœ
wg show

# íŠ¹ì • ì¸í„°í˜ì´ìŠ¤ ìƒì„¸
wg show wg0

# ì—°ê²°ëœ í”¼ì–´ ìˆ˜
wg show all dump | grep peer | wc -l
```

### íŠ¸ë˜í”½ ëª¨ë‹ˆí„°ë§

```bash
# ì‹¤ì‹œê°„ ëŒ€ì—­í­
iftop -i enp0s21f0u4

# ì¸í„°í˜ì´ìŠ¤ í†µê³„
vnstat -l -i enp0s21f0u4

# ì—°ê²° ë¡œê·¸
journalctl -u wg-quick@wg0 -f
```

### ì—ì´ì „íŠ¸ ê´€ë¦¬

```python
# Pythonìœ¼ë¡œ ì—ì´ì „íŠ¸ ëª¨ë‹ˆí„°ë§
from agent_connection_manager import AgentConnectionManager

manager = AgentConnectionManager()
manager.monitor_agents()  # ì „ì²´ ì—ì´ì „íŠ¸ ìƒíƒœ ì¶œë ¥
manager.cleanup_inactive_agents()  # ë¹„í™œì„± ì—ì´ì „íŠ¸ ì •ë¦¬
```

---

## ğŸ›¡ï¸ ë³´ì•ˆ ì„¤ì •

### ë°©í™”ë²½ ê·œì¹™

```bash
# VPN í¬íŠ¸ í—ˆìš©
firewall-cmd --permanent --add-port=51820-51825/udp
firewall-cmd --reload

# SSHëŠ” ìœ ì§€í•˜ë©´ì„œ ë‹¤ë¥¸ íŠ¸ë˜í”½ ì°¨ë‹¨
iptables -A INPUT -p tcp --dport 22 -j ACCEPT
iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
iptables -P INPUT DROP
```

### ì¸ì¦ ì‹œìŠ¤í…œ í™œì„±í™”

```python
# VPN ì¸ì¦ ê´€ë¦¬ì ì‹¤í–‰
python3 src/vpn_auth_manager.py

# ì„ì‹œ ì•¡ì„¸ìŠ¤ ìƒì„± (24ì‹œê°„)
manager.create_temp_access(duration_hours=24)

# QR ì½”ë“œ ìƒì„±
manager.generate_qr_access("ì‚¬ìš©ìëª…")
```

---

## ğŸ“Š ì„±ëŠ¥ ìµœì í™”

### ëŒ€ì—­í­ ê´€ë¦¬

100Mbps ì´ë”ë„· í™˜ê²½ì—ì„œ 20ê°œ ë™ê¸€ ì‚¬ìš© ì‹œ:
- ê° ë™ê¸€ë‹¹ 5Mbps ì œí•œ í•„ìš”
- ê¸°ê°€ë¹„íŠ¸ ì´ë”ë„· ì—…ê·¸ë ˆì´ë“œ ê¶Œì¥

```bash
# QoS ì„¤ì • (ë™ê¸€ë‹¹ 5Mbps ì œí•œ)
tc qdisc add dev enp0s21f0u4 root handle 1: htb
tc class add dev enp0s21f0u4 parent 1: classid 1:1 htb rate 5mbit
```

### MTU ìµœì í™”

```bash
# WireGuard MTU ì„¤ì •
wg set wg0 mtu 1420

# ì‹œìŠ¤í…œ MTU í™•ì¸
ip link show wg0
```

---

## ğŸ”„ ìë™ ì‹œì‘ ì„¤ì •

```bash
# ê° VPN ì¸í„°í˜ì´ìŠ¤ ìë™ ì‹œì‘
for i in {0..5}; do
    sudo systemctl enable wg-quick@wg$i
done

# ìƒíƒœ í™•ì¸
systemctl status wg-quick@wg0
```

---

## â— ë¬¸ì œ í•´ê²°

### ì—°ê²° ì‹¤íŒ¨ ì‹œ

```bash
# ì¸í„°í˜ì´ìŠ¤ ì¬ì‹œì‘
wg-quick down wg0
wg-quick up wg0

# ë¼ìš°íŒ… í…Œì´ë¸” í™•ì¸
ip route show table 200

# NAT ê·œì¹™ í™•ì¸
iptables -t nat -L POSTROUTING -n -v
```

### ë™ê¸€ ì¸ì‹ ë¬¸ì œ

```bash
# USB ë””ë°”ì´ìŠ¤ í™•ì¸
lsusb

# ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ í™•ì¸
ip link show | grep enp

# NetworkManager ì¬ì‹œì‘
systemctl restart NetworkManager
```

---

## ğŸ“ ì„¤ì • íŒŒì¼ ìœ„ì¹˜

```
/etc/wireguard/         # WireGuard ì„¤ì •
â”œâ”€â”€ wg0.conf           # VPN ì„œë²„ 0
â”œâ”€â”€ wg1.conf           # VPN ì„œë²„ 1
â””â”€â”€ ...

/home/proxy/            # ê´€ë¦¬ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ scripts/           # ì…¸ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ src/              # Python ì½”ë“œ
â””â”€â”€ configs/          # ì„¤ì • í…œí”Œë¦¿
```

---

## ğŸ¯ ì‚¬ìš© ì˜ˆì‹œ

### 4-6ê°œ ì—ì´ì „íŠ¸ ë™ì‹œ ì ‘ì†

```javascript
// Playwright ì˜ˆì‹œ
const agents = [];
for (let i = 0; i < 6; i++) {
    const agent = await connectToVPN(port: 51820 + i);
    agents.push(agent);
}

// ëª¨ë“  ì—ì´ì „íŠ¸ê°€ ë‹¤ë¥¸ ë™ê¸€ IP ì‚¬ìš©
agents.forEach(agent => {
    console.log(await agent.getIP());
});
```

---

## ğŸ“ ì§€ì›

ë¬¸ì œ ë°œìƒ ì‹œ ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:
1. ëª¨ë“  ìŠ¤í¬ë¦½íŠ¸ê°€ ì‹¤í–‰ ê¶Œí•œì´ ìˆëŠ”ì§€
2. IP í¬ì›Œë”©ì´ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€
3. ë°©í™”ë²½ì´ VPN í¬íŠ¸ë¥¼ í—ˆìš©í•˜ëŠ”ì§€
4. ë™ê¸€ì´ ì •ìƒì ìœ¼ë¡œ ì¸í„°ë„·ì— ì—°ê²°ë˜ì–´ ìˆëŠ”ì§€

---

**ì‘ì„±ì¼**: 2024ë…„
**ë²„ì „**: 1.0
**ë¼ì´ì„ ìŠ¤**: MIT